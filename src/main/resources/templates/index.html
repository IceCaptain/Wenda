<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8"/>
<title>抓取网页资源</title>
<link rel="stylesheet" type="text/css" href="/static/bootstrap3/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="/static/bootstrap3/css/bootstrap-theme.min.css" />
<link rel="stylesheet" type="text/css" href="/static/css/index.css" />
<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/bootstrap3/js/bootstrap.min.js"></script>
<style type="text/css">
</style>
<script th:inline="javascript">
	/*<![CDATA[*/	
	$(function(){
		$("#url").focus();
	});
	
function IsURL (str_url) { 
	var strRegex = '^((https|http|ftp|rtsp|mms)?://)'
	+ '?(([0-9a-z_!~*\'().&=+$%-]+: )?[0-9a-z_!~*\'().&=+$%-]+@)?' //ftp的user@ 
	+ '(([0-9]{1,3}.){3}[0-9]{1,3}' // IP形式的URL- 199.194.52.184 
	+ '|' // 允许IP和DOMAIN（域名） 
	+ '([0-9a-z_!~*\'()-]+.)*' // 域名- www. 
	+ '([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].' // 二级域名 
	+ '[a-z]{2,6})' // first level domain- .com or .museum 
	+ '(:[0-9]{1,4})?' // 端口- :80 
	+ '((/?)|' // a slash isn't required if there is no file name 
	+ '(/[0-9a-z_!~*\'().;?:@&=+$,%#-]+)+/?)$'; 
	var re=new RegExp(strRegex); 
	if (re.test(str_url)) { 
		return true; 
	} else { 
		return false; 
	} 
}
		
	function mySubmit(){
		var url=$("#url").val();
		var items=$(".item");
		var itemsLength=items.length;
		var choices=[];
		for(var i=0;i<itemsLength;i++){
			if(items[i].checked){
				choices.push(items[i].value);
			}
		}
		if(url==null||url==""){
			$("#error").css("display","block");
			$("#error").html("请输入需要抓取的网址！");
			return;
		}
		else if(IsURL(url)==false){
			$("#error").css("display","block");
			$("#error").html("网址格式有误！");
			return;
		}
		else if(choices.length<=0){
			$("#error").css("display","block");
			$("#error").html("请选择需要抓取的资源！");
			return;
		}else{
			$("#error").css("display","block");
			//#9CB1E0 #206687
			$("#error").css("color","#206687");
			$("#error").html("正在为您抓取资源，请稍等...");
			var choicesStr=choices.join(",");
			$.post("/grab",{url:url,choicesStr:choicesStr},function(result){
				if(result.success){
					$("#error").css("display","none");
					$("#error").html("");
					$("#error").css("color","red");
					alert(result.success);
				}
			},"json");
		}
	}
	/*]]>*/
</script>
</head>
<body>
	<div class="container">
		<div class="row" id="title">
			<div class="col-md-3"></div>
			<div class="col-md-6">
				<div class="jumbotron">
  					<h2>抓取网站资源</h2>
				</div>
			</div>
			<div class="col-md-3"></div>
		</div>
		<div class="row" id="input">
			<div class="col-md-3"></div>
			<div class="col-md-6">
				<div class="input-group form-group">
					<input type="text" id="url" class="form-control" onkeydown="if(event.keyCode==13) mySubmit()" placeholder="请输入抓取的网址..."/>
					<span class="input-group-btn">
						<button type="button" id="submit" class="btn" onclick="mySubmit()" style="background-color: #0096E6">
							<span th:text="开始" style="color: #FFFFFF"></span>
						</button>
					</span>
				</div>
				<div class="row">
					<div class="col-md-12">
						<font id="error" color="red"></font>
					</div>
				</div>
			</div>
			<div class="col-md-3"></div>
		</div>
		<div class="row" id="message">
			<div class="col-md-3"></div>
			<div class="col-md-6">
				<div class="tip">
					<p>输入网址如：<font class="url">http://www.xxx.com，www.xxx.com</font>&nbsp;&nbsp;<font class="msg">(默认存储路径：D://website)</font></p>
				</div>
			</div>
			<div class="col-md-3"></div>
		</div>
		<div class="row" id="checkbox">
			<div class="col-md-3"></div>
			<div class="col-md-6">
				<div class="choice">
					<font class="ckMsg">请选择需要抓取的资源：</font>
					<label><input type="checkbox" class="item" value="a"/>超链接(Url)</label>
					<label><input type="checkbox" class="item" value="img"/>图片(Img)</label>
					<label><input type="checkbox" class="item" value="css"/>样式表(Css)</label>
					<label><input type="checkbox" class="item" value="js"/>脚本文件(Js)</label>
				</div>
			</div>
			<div class="col-md-3"></div>
		</div>
	</div>
</body>
</html>